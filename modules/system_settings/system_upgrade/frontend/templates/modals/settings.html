<!doctype html>
<html lang="zh-CN"><head>
  <meta charset="utf-8" />
  <title>更新设置</title>
  <link rel="stylesheet" href="/modules/_themes/default/root.css" />
  <link rel="stylesheet" href="/modules/system_settings/system_upgrade/frontend/static/system_upgrade.css" />
  <script src="/modules/common/frontend/static/shell_api.js"></script>
  <style>
    body{ padding:16px; }
    .row{ margin-top:12px; display:flex; gap:8px; justify-content:flex-end; }
    label{ display:block; margin:8px 0; color:#374151; }
  </style>
</head><body>
  <h3 style="margin:0 0 10px;">更新设置</h3>
  <div>
    <label><input type="checkbox" id="optBackup" /> 执行前创建备份快照</label>
    <label><input type="checkbox" id="optOnlyChanged" /> 仅更新有变动的文件</label>
    <label><input type="checkbox" checked disabled /> 不清数据库（固定）</label>
  </div>
  <div class="row">
    <button class="btn" id="btnCancel">取消</button>
    <button class="btn btn--black" id="btnSave">保存</button>
  </div>
  <script>
    (function(){
      const p = new URLSearchParams(location.search);
      const b = p.get('backup'); const oc = p.get('only_changed');
      document.getElementById('optBackup').checked = b === '1' || b === 'true';
      document.getElementById('optOnlyChanged').checked = oc === '1' || oc === 'true';
      document.getElementById('btnCancel').onclick = ()=> ShellAPI.closeModal();
      document.getElementById('btnSave').onclick = ()=>{
        ShellAPI.emitResult('system_upgrade', 'settingsSaved', {
          optBackup: document.getElementById('optBackup').checked,
          optOnlyChanged: document.getElementById('optOnlyChanged').checked
        });
        ShellAPI.closeModal();
      };
    })();
  </script>
</body></html>
