{% extends "layout.html" %}{% block content %}
<h2>PDF 列表</h2>
<form method="post" action="/admin/reconcile" class="row" onsubmit="return confirm('对齐文件夹与列表？这会规范化文件名并补登记缺失项。')">
  <button type="submit" class="primary">对齐文件夹与列表</button>
</form>
<form method="get" class="row">
  <input name="q" value="{{q or ''}}" placeholder="按运单搜索"><button type="submit">查询</button>
</form>
<form method="post" action="/admin/files/batch_delete_all" class="row" onsubmit="return confirm('确定批量删除？若未设置搜索条件将删除全部 PDF。')">
  <input type="hidden" name="q" value="{{q or ''}}"><button type="submit" class="danger">批量删除</button>
</form>
<table class="table">
  <thead><tr><th>#</th><th>运单</th><th>文件</th><th>上传时间</th><th>操作</th></tr></thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td>{{loop.index + (page-1)*page_size}}</td>
      <td>{{r.tracking_no}}</td>
      <td>{{r.file_path}}</td>
      <td>{{r.uploaded_at}}</td>
      <td><a href="/admin/file/{{r.tracking_no}}" target="_blank">下载</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div class="pager">
  {% for p in range(1, pages+1) %}
    {% if p==page %}<b>{{p}}</b>{% else %}<a href="?page={{p}}&q={{q or ''}}">{{p}}</a>{% endif %}
  {% endfor %}
</div>
{% endblock %}
