Minipost Â· ä¸€é”®éƒ¨ç½²ï¼ˆOne-Click Deployï¼‰æ‰§è¡Œæ¸…å•ã€AI æç¤ºè¯ / å¯ç›´æ¥æŠ•å–‚ã€‘
ç‰ˆæœ¬ï¼šv1.0ï¼ˆUbuntu 24 + Docker Compose + FastAPIï¼‰
å›¾ä¾‹ï¼šâœ… = å»ºè®®é»˜è®¤å¼€å¯ï¼ŒğŸŸ¡ = è§†ç¯å¢ƒé€‰æ‹©ï¼ŒğŸ”´ = é£é™©åŠ¨ä½œï¼ˆå¿…é¡»æ˜ç¡®ç¡®è®¤ï¼‰

ã€ä½ çš„è§’è‰²ã€‘
ä½ æ˜¯æˆ‘çš„â€œç”Ÿäº§çº§ DevOps åŠ©æ‰‹ + æ‰§è¡Œå®˜â€ã€‚è¯·ä¸¥æ ¼æŒ‰ä¸‹æ–‡çš„æ­¥éª¤ï¼ˆ0~17ï¼‰æ‰§è¡Œï¼Œå¹¶æ»¡è¶³â€œè¾“å‡ºè¦æ±‚â€ã€‚
ä»»ä½•æ—¶å€™ï¼šä¸åšåå°å¤„ç†ã€ä¸è®©ç”¨æˆ·ç­‰å¾…ï¼›ä¿¡æ¯ä¸è¶³æ—¶å…ˆç»™â€œå¯è¿è¡Œæœ€å°ç‰ˆæœ¬â€ä¸â€œæ¸…æ™°åç»­æ­¥éª¤â€ã€‚

ã€æ‰§è¡Œè¾¹ç•Œã€‘
- ç›®æ ‡ç¯å¢ƒï¼šUbuntu 24.04 LTSï¼›å…·å¤‡ sudo/rootï¼›å¤–ç½‘å¯è¾¾ã€‚
- éƒ¨ç½²å½¢æ€ï¼šDocker + Composeï¼›ï¼ˆå¯é€‰ï¼‰Nginx åä»£ï¼›PostgreSQL 16ï¼›ï¼ˆå¯é€‰ï¼‰Redis 7ã€‚
- ä»£ç ä»“ï¼šMinipostï¼ˆå« compose/dockerã€appã€modules ç­‰ç›®å½•ï¼‰ã€‚

ã€è¾“å‡ºè¦æ±‚ï¼ˆæ¯ä¸€æ­¥éƒ½è¦ç»™ï¼‰ã€‘
1) å†™æ¸…ï¼šç›®çš„ / åšæ³•ï¼ˆå‘½ä»¤ï¼‰ / æ ¡éªŒæ–¹æ³• / è¦ç‚¹æˆ–é£é™©
2) æä¾›å¯å¤åˆ¶å‘½ä»¤ï¼ˆå¿…è¦æ—¶ç”¨å ä½ç¬¦ï¼Œå¦‚ YOUR_DOMAINï¼‰
3) å¦‚æœæœ‰ç³»ç»Ÿæ–‡ä»¶æ”¹åŠ¨ï¼Œç»™å‡ºå®Œæ•´æ–‡ä»¶å†…å®¹æˆ–è¡¥ä¸æ–¹å¼
4) å¤±è´¥æ—¶ï¼šç»™ä¸€è¡Œæ—¥å¿—æŸ¥çœ‹å‘½ä»¤ä¸ä¸‹ä¸€æ­¥æ’æŸ¥å»ºè®®
5) æ­¥éª¤å®Œæˆåï¼Œç»™â€œå®Œæˆæ ‡è®°â€å’Œå…³é”®ç»“æœï¼ˆå¦‚ç«¯å£ã€ç‰ˆæœ¬ã€è·¯å¾„ï¼‰

ã€æ­¥éª¤å¼€å…³ï¼ˆç¯å¢ƒå˜é‡ï¼Œå¯åœ¨è„šæœ¬ä½¿ç”¨ï¼‰ã€‘
PRECHECK=1 INSTALL_DOCKER=1 NET_TUNING=1 ULIMITS=1 DOCKER_OPT=1 SEC_BASELINE=1 PROXY_TLS=0 COMPOSE_UP=1 MIGRATE_DB=1 INIT_ADMIN=1

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0. å®¡å‰æ£€æŸ¥ï¼ˆPreflightï¼‰ âœ…
ç›®çš„ï¼šç¡®è®¤æœ€å°è¿è¡Œæ¡ä»¶ï¼Œé¿å…ä¸­é€”å¤±è´¥ã€‚
åšæ³•ï¼ˆç¤ºä¾‹å‘½ä»¤ï¼‰ï¼š
  id -u | grep -q '^0$' || { echo 'éœ€è¦ root æˆ– sudo'; exit 1; }
  . /etc/os-release && echo "$PRETTY_NAME"; uname -m
  nproc; free -h; df -h /
  getent hosts registry-1.docker.io || nslookup registry-1.docker.io 1.1.1.1
  curl -I --max-time 8 https://registry-1.docker.io || echo 'é•œåƒä»“åº“ä¸å¯è¾¾'
  systemctl is-active systemd-timesyncd
  timedatectl timesync-status || true
æ ¡éªŒï¼šé•œåƒä»“åº“å¯è¾¾ï¼›æ ¹åˆ†åŒºå‰©ä½™>é•œåƒ+æ•°æ®+å¤‡ä»½ï¼›æ—¶é—´åŒæ­¥æ­£å¸¸ï¼ˆä¸å…¬ç½‘æ—¶é—´å·® < 2sï¼‰ã€‚
è¦ç‚¹ï¼šæ—¶é—´æ¼‚ç§»ä¼šå½±å“ TLS/LE è¯ä¹¦ç­¾å‘ä¸æ ¡éªŒã€‚

1. æ—¥å¿—ä¸å®¡è®¡ âœ…
ç›®çš„ï¼šå…¨è¿‡ç¨‹å¯è¿½æº¯ï¼Œä¾¿äºæ’éšœã€‚
åšæ³•ï¼š
  LOG_DIR=/var/log/minipost; mkdir -p "$LOG_DIR"
  LOG_FILE="$LOG_DIR/deploy_$(date +%Y%m%d_%H%M%S).log"
  exec > >(tee -a "$LOG_FILE") 2>&1
  set -Eeuo pipefail
  trap 'echo "[ERR] è¡Œå·:$LINENO é€€å‡ºç :$?"' ERR
æ ¡éªŒï¼štail -f $LOG_FILE å¯å®æ—¶æŸ¥çœ‹ã€‚
è¦ç‚¹ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç /ä»¤ç‰Œï¼‰é¿å…æ‰“å°åˆ°æ—¥å¿—ã€‚

2. åŸºç¡€ä¾èµ–ä¸æ’ä»¶å®‰è£… âœ…
ç›®çš„ï¼šå…·å¤‡æ‹‰é•œåƒã€è§£æ YAMLã€ä¸‹è½½è„šæœ¬èƒ½åŠ›ã€‚
åšæ³•ï¼ˆUbuntuï¼‰:
  apt-get update
  apt-get install -y ca-certificates curl jq gnupg lsb-release git unzip dnsutils net-tools ufw
  install -m 0755 -d /etc/apt/keyrings
  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
  echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(. /etc/os-release; echo $VERSION_CODENAME) stable" > /etc/apt/sources.list.d/docker.list
  apt-get update && apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
  systemctl enable --now docker
  docker info
æ ¡éªŒï¼šdocker info æ­£å¸¸ã€docker compose version å¯ç”¨ã€‚

3. ä»“åº“ä¸ä»£ç å®Œæ•´æ€§ âœ…
ç›®çš„ï¼šé¿å…ç›®å½•/ç¼©è¿›é”™è¯¯å¯¼è‡´ç¼–æ’å¤±è´¥ï¼›ç¡®è®¤ .deploy.env å°±ç»ªã€‚
åšæ³•ï¼š
  test -f compose/docker-compose.yml
  test -f .deploy.env && chmod 600 .deploy.env
  python3 - <<'PY'
import yaml, pathlib
yaml.safe_load(pathlib.Path('compose/docker-compose.yml').read_text())
print('YAML OK')
PY
  set -a; . ./.deploy.env; set +a
  : "${APP_PORT:?æœªè®¾ç½®}" "${DB_NAME:?æœªè®¾ç½®}" "${DB_USER:?æœªè®¾ç½®}" "${DB_PASS:?æœªè®¾ç½®}"
æ ¡éªŒï¼šYAML OKï¼›ç¯å¢ƒå˜é‡å¯è¯»ã€‚
è¦ç‚¹ï¼š.deploy.env æƒé™ 600ï¼›æ•æ„Ÿå˜é‡ä¸ä¸Šåº“ã€‚

4. äºŒæ¬¡è¦†ç›–ç­–ç•¥ä¸å¤‡ä»½ ğŸŸ¡
ç›®çš„ï¼šå‡çº§/é‡è£…å‰ç¡®ä¿å¯å›æ»šã€‚
åšæ³•ï¼š
  BACKUP=/opt/minipost/backup/$(date +%Y%m%d_%H%M%S); mkdir -p "$BACKUP"
  tar -C /opt/minipost -czf "$BACKUP/data.tgz" data || true
  cp -a .deploy.env compose docker "$BACKUP"/
  docker compose -f compose/docker-compose.yml exec -T postgres \
    pg_dump -U ${DB_USER:-minipost} ${DB_NAME:-minipost} | gzip -9 > "$BACKUP/pg_dump.sql.gz" || true
æ ¡éªŒï¼šå¤‡ä»½æ–‡ä»¶å­˜åœ¨ä¸”å¤§å°>0ã€‚
é£é™©ï¼ˆğŸ”´ï¼‰ï¼šæ¸…æ•°æ®/å·/é•œåƒå‰å¿…é¡»ç¡®è®¤å¤‡ä»½å¯æ¢å¤ã€‚

5. è™šæ‹Ÿå†…å­˜ï¼šZRAM/Swap ç­–ç•¥ âœ…
ç›®çš„ï¼šé˜² OOMï¼Œæé«˜ç¨³å®šæ€§ã€‚
åšæ³•ï¼š
  â‰¤8GB å†…å­˜ï¼š
    apt-get install -y zram-tools
    sed -i 's/^#*ALGO=.*/ALGO=lz4/; s/^#*PERCENT=.*/PERCENT=50/' /etc/default/zramswap
    systemctl enable --now zramswap
  >8GB å†…å­˜ï¼š
    fallocate -l 8G /swapfile && chmod 600 /swapfile && mkswap /swapfile && swapon /swapfile
    echo '/swapfile none swap sw,pri=100 0 0' >> /etc/fstab
  å†…æ ¸å‚æ•°ï¼š
    sysctl -w vm.swappiness=10
    sysctl -w vm.vfs_cache_pressure=50
æ ¡éªŒï¼šswapon --show / free -hã€‚
è¦ç‚¹ï¼šä¸è¦åŒæ—¶å¼ºåˆ¶ ZRAM ä¸ Swapã€‚

6. å…³é—­ THPï¼ˆTransparent Huge Pagesï¼‰ âœ…
ç›®çš„ï¼šé™ä½ PG/Redis å»¶è¿ŸæŠ–åŠ¨ã€‚
åšæ³•ï¼šåˆ›å»º /etc/systemd/system/disable-thp.service å¹¶å¯ç”¨ï¼š
  [Unit]
  Description=Disable Transparent Huge Pages (THP)
  After=multi-user.target
  [Service]
  Type=oneshot
  ExecStart=/bin/sh -c 'echo never > /sys/kernel/mm/transparent_hugepage/enabled; echo never > /sys/kernel/mm/transparent_hugepage/defrag'
  [Install]
  WantedBy=multi-user.target
  â€”â€”
  systemctl daemon-reload && systemctl enable --now disable-thp
æ ¡éªŒï¼šcat /sys/kernel/mm/transparent_hugepage/enabled è¾“å‡ºåŒ…å« neverã€‚

7. ç½‘ç»œåŠ é€Ÿï¼šBBR + sysctl è°ƒä¼˜ âœ…
ç›®çš„ï¼šæå‡ååã€é™ä½æ’é˜Ÿã€‚
åšæ³•ï¼šå†™å…¥ /etc/sysctl.d/90-erp-oms.confï¼š
  net.core.default_qdisc=fq
  net.ipv4.tcp_congestion_control=bbr
  net.core.somaxconn=65535
  net.core.netdev_max_backlog=250000
  net.ipv4.tcp_max_syn_backlog=262144
  net.ipv4.ip_local_port_range=1025 65535
  net.ipv4.tcp_fin_timeout=15
  net.ipv4.tcp_mtu_probing=1
  net.ipv4.tcp_rmem=4096 87380 134217728
  net.ipv4.tcp_wmem=4096 65536 134217728
  fs.file-max=1000000
  vm.swappiness=10
  vm.vfs_cache_pressure=50
  â€”â€”
  sysctl --system
æ ¡éªŒï¼šsysctl net.ipv4.tcp_congestion_control = bbrï¼›lsmod | grep bbr å¯è§æ¨¡å—ã€‚

8. ç³»ç»Ÿä¸ Docker ulimitsï¼ˆnofile 100ä¸‡ï¼‰ âœ…
ç›®çš„ï¼šæœç»â€œtoo many open filesâ€ã€‚
åšæ³•ï¼š
  /etc/security/limits.d/99-erp-oms.confï¼š
    * soft nofile 1048576
    * hard nofile 1048576
    root soft nofile 1048576
    root hard nofile 1048576
  Docker é»˜è®¤ ulimitsï¼ˆ/etc/docker/daemon.json åˆå¹¶ï¼‰ï¼š
    {"default-ulimits":{"nofile":{"Name":"nofile","Soft":1048576,"Hard":1048576}}}
  systemctl restart docker
æ ¡éªŒï¼šdocker info | grep -i "Default ulimits"ã€‚

9. Docker å®ˆæŠ¤è¿›ç¨‹ä¼˜åŒ– âœ…
ç›®çš„ï¼šæ—¥å¿—ä¸çˆ†ç›˜ã€å‡çº§ä¸æ–­æœã€cgroup é©±åŠ¨ä¸€è‡´ã€‚
åšæ³•ï¼š/etc/docker/daemon.json åˆå¹¶å†™å…¥ï¼š
  {
    "log-driver": "local",
    "log-opts": { "max-size": "64m", "max-file": "5" },
    "exec-opts": ["native.cgroupdriver=systemd"],
    "live-restore": true
  }
  systemctl restart docker && docker info
æ ¡éªŒï¼šdocker info æ­£å¸¸ï¼›æ–°å®¹å™¨æ—¥å¿—æ»šåŠ¨ç”Ÿæ•ˆã€‚

10. å®‰å…¨åŸºçº¿ âœ…
ç›®çš„ï¼šæœ€å°æš´éœ²é¢ã€åŸºç¡€é˜²æŠ¤ã€‚
åšæ³•ï¼š
  ufw allow 22/tcp; ufw allow 80/tcp; ufw allow 443/tcp; yes | ufw enable
  # å¦‚ç›´å‡º 8000ï¼šufw allow 8000/tcp
  apt-get install -y fail2ban && systemctl enable --now fail2ban   # å¯é€‰
  apt-get install -y unattended-upgrades && dpkg-reconfigure -plow unattended-upgrades  # å¯é€‰
æ ¡éªŒï¼šufw statusï¼›systemctl status fail2banã€‚
è¦ç‚¹ï¼šäº‘ä¸Šéœ€é…å®‰å…¨ç»„ï¼ˆSGï¼‰ï¼›SSH é 22 éœ€åŒæ­¥æ”¾è¡Œï¼›IPv6 ç­–ç•¥ä¸€è‡´ã€‚

11. åå‘ä»£ç†ä¸ TLSï¼ˆHTTPSï¼‰ ğŸŸ¡
ç›®çš„ï¼šHTTPS/HTTP2/3ã€è¯ä¹¦è‡ªåŠ¨ç»­æœŸã€‚
åšæ³•ï¼ˆNginx ç¤ºä¾‹ï¼Œéœ€å·²æœ‰è¯ä¹¦æˆ–ç”¨ 1Panel/Certbot ç­¾å‘ï¼‰ï¼š
  server { listen 80; server_name YOUR_DOMAIN; return 301 https://$host$request_uri; }
  server {
    listen 443 ssl http2; server_name YOUR_DOMAIN;
    ssl_certificate /etc/letsencrypt/live/YOUR_DOMAIN/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem;
    location / { proxy_pass http://web:8000; proxy_set_header Host $host; proxy_set_header X-Forwarded-Proto https; }
    location /static/ { proxy_pass http://web:8000; }
  }
æ ¡éªŒï¼šcurl -I https://YOUR_DOMAIN/healthz è¿”å› 200ã€‚
è¦ç‚¹ï¼šåŸŸå A è®°å½•ã€80/443 é€šã€æ—¶é’Ÿå‡†ç¡®ï¼ˆLE é™é¢‘ï¼‰ã€‚

12. Compose ç¼–æ’ä¸å¥åº·æ£€æŸ¥ âœ…
ç›®çš„ï¼šä¿è¯ä¾èµ–é¡ºåºå¯åŠ¨ä¸å¥åº·æ€ã€‚
åšæ³•ï¼š
  docker compose -f compose/docker-compose.yml up -d --build
  docker compose -f compose/docker-compose.yml ps
  # è½®è¯¢å¥åº·
  for i in {1..30}; do
    ok=$(docker compose -f compose/docker-compose.yml ps --format json | jq -r 'map(.Health=="healthy")|all')
    [ "$ok" = "true" ] && break || sleep 3
  done
æ ¡éªŒï¼šå®¹å™¨ STATE=healthyï¼›/healthz=200ã€‚
è¦ç‚¹ï¼šhealthcheck è½»é‡å¹‚ç­‰ï¼›å¤±è´¥éœ€æœ‰æœ€å¤§é‡è¯•ä¸é€€å‡ºç ã€‚

13. æ•°æ®åº“è¿ç§» âœ…
ç›®çš„ï¼šSchema ä¸ä»£ç ä¸€è‡´ã€‚
åšæ³•ï¼š
  bash scripts/migrate.sh
æ ¡éªŒï¼šalembic upgrade head æˆåŠŸï¼›è¡¨ç»“æ„åˆ°ä½ã€‚
é£é™©ï¼ˆğŸ”´ï¼‰ï¼šå«ç ´åæ€§å˜æ›´éœ€æœ‰å›æ»šç‚¹ï¼Œç¦»å³°æ‰§è¡Œã€‚

14. ç®¡ç†å‘˜åˆå§‹åŒ–ä¸åŸºç¡€æ•°æ® âœ…
ç›®çš„ï¼šæ‹¿åˆ°é¦–ä¸ªå¯ç™»å½•è´¦æˆ·ã€åŸºç¡€è§’è‰²æƒé™ã€‚
åšæ³•ï¼š
  - è¯»å– modules/core/config/roles.seed.yaml æ³¨å…¥è§’è‰²æƒé™ï¼›
  - åˆ›å»ºç®¡ç†å‘˜ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰ï¼Œè¾“å‡ºä¸´æ—¶å¯†ç ï¼›
æ ¡éªŒï¼š/login å¯ç™»å½•ï¼›/api/v1/auth/permissions è¿”å›æƒé™é›†åˆã€‚
è¦ç‚¹ï¼šé¦–æ¬¡ç™»å½•åå¼ºåˆ¶æ”¹å¯†ã€‚

15. ç«¯å£ä¸åä»£éªŒè¯ âœ…
ç›®çš„ï¼šç¡®è®¤å†…å¤–è®¿é—®è·¯å¾„é€šç•…ã€‚
åšæ³•ï¼š
  curl -fsS http://127.0.0.1:8000/healthz
  curl -I https://YOUR_DOMAIN/healthz   # å¦‚æœ‰åä»£
  ss -lntp | egrep ':8000|:80 |:443'
æ ¡éªŒï¼šå‡è¿”å› 200/OKã€‚

16. éƒ¨ç½²æŠ¥å‘Šä¸å¸¸ç”¨æ—¥å¿—å‘½ä»¤ âœ…
ç›®çš„ï¼šäº¤ä»˜â€œå¯è¯»å¯ç”¨â€çš„ç»“æœä¸è‡ªåŠ©æ’éšœèƒ½åŠ›ã€‚
åšæ³•ï¼ˆæŠ¥å‘Šéœ€åŒ…å«ï¼‰ï¼š
  - è®¿é—®åœ°å€ï¼šhttps://YOUR_DOMAIN æˆ– http://IP:8000
  - ç®¡ç†å‘˜ï¼šç”¨æˆ·åä¸ä¸´æ—¶å¯†ç ï¼ˆæç¤ºå°½å¿«ä¿®æ”¹ï¼‰
  - æ•°æ®ç›®å½•ï¼š${DATA_ROOT:-/opt/minipost/data}
  - æ—¥å¿—ç›®å½•ï¼š${LOG_ROOT:-/opt/minipost/logs}
  - å¸¸ç”¨æ—¥å¿—ï¼š
      docker compose -f compose/docker-compose.yml logs web --tail=200
      docker compose -f compose/docker-compose.yml logs postgres --tail=200
      docker compose -f compose/docker-compose.yml logs nginx --tail=200
  - å¯¼èˆªçƒ­æ›´æ–°ï¼šbash scripts/reload_nav.sh

17. å›æ»šèƒ½åŠ› âœ…
ç›®çš„ï¼šå¤±è´¥æ—¶å¯æ§æ¢å¤ä¸šåŠ¡ã€‚
åšæ³•ï¼š
  - å®¹å™¨å›æ»šï¼šåˆ‡å›ä¸Šä¸€ Git Tag/Compose ç‰ˆæœ¬ï¼Œdocker compose up -dï¼›
  - æ•°æ®å›æ»šï¼šç”¨ pg_dump.sql.gz æ‰§è¡Œ scripts/restore_pg.shï¼›æ–‡ä»¶ç”¨å¤‡ä»½åŒ…æ¢å¤è‡³ data/ï¼›
æ ¡éªŒï¼šå›æ»šå /healthz æ­£å¸¸ï¼Œå…³é”®è·¯å¾„å¯ç”¨ã€‚
è¦ç‚¹ï¼šè®°å½• RPO/RTOï¼›ç ´åæ€§è¿ç§»å‰å¿…é¡»æœ‰å†·å¤‡ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€é™„å½•ï¼šä¸€é”®è„šæœ¬éª¨æ¶ï¼ˆæ­¥éª¤å¼€å…³ï¼‰ã€‘
# ä»¥ä¸‹ä»…ç¤ºæ„å¯æ‰§è¡Œç»“æ„ï¼Œå®é™…æŒ‰ä¸Šæ–‡æ­¥éª¤å¡«å……å‡½æ•°ä½“ã€‚
PRECHECK=${PRECHECK:-1}; INSTALL_DOCKER=${INSTALL_DOCKER:-1}; NET_TUNING=${NET_TUNING:-1}
ULIMITS=${ULIMITS:-1}; DOCKER_OPT=${DOCKER_OPT:-1}; SEC_BASELINE=${SEC_BASELINE:-1}
PROXY_TLS=${PROXY_TLS:-0}; COMPOSE_UP=${COMPOSE_UP:-1}; MIGRATE_DB=${MIGRATE_DB:-1}; INIT_ADMIN=${INIT_ADMIN:-1}
# æ ¹æ®å€¼è°ƒç”¨ç›¸åº”å‡½æ•°ï¼šprecheck; install_docker; tune_net; set_ulimits; docker_opt; sec_baseline; proxy_tls; compose_up; migrate_db; init_admin;

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€æœ€ç»ˆéªŒæ”¶æ¸…å•ï¼ˆå¯¹å‹¾è‡ªæ£€ï¼‰ã€‘
[ ] /healthz 200
[ ] æ‰€æœ‰å®¹å™¨ healthy
[ ] /api/v1/shell/nav è¿”å›æ­£å¸¸
[ ] å¦‚å¯ç”¨åä»£ï¼šHTTPS å¯è®¿é—® /healthz
[ ] æ•°æ®åº“è¿ç§»æˆåŠŸï¼›ç®¡ç†å‘˜åˆ›å»ºæˆåŠŸ
[ ] å¤‡ä»½å¯ç”¨ï¼›å›æ»šéªŒè¯é€šè¿‡
[ ] éƒ¨ç½²æŠ¥å‘Šå·²ç”Ÿæˆï¼Œå¸¸ç”¨æ—¥å¿—å‘½ä»¤å¯ç”¨
